<!DOCTYPE html>
<html><head><meta charset="UTF-8"><link href="css/default.css" rel="stylesheet" type="text/css"><script src="js/jquery.min.js" type="text/javascript"></script><script src="js/page_effects.js" type="text/javascript"></script><title>overseer.api documentation</title></head><body><div id="header"><h2>Generated by <a href="https://github.com/weavejester/codox">Codox</a></h2><h1><a href="index.html">Overseer 0.6.11 API documentation</a></h1></div><div class="sidebar" id="namespaces"><h3><a href="index.html"><span class="inner">Namespaces</span></a></h3><ul><li class="depth-1"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>overseer</span></div></div></li><li class="depth-2 branch current"><a href="overseer.api.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>api</span></div></a></li><li class="depth-2 branch"><a href="overseer.schema.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>schema</span></div></a></li><li class="depth-2"><a href="overseer.status.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>status</span></div></a></li></ul></div><div class="sidebar" id="vars"><h3><a href="#top"><span class="inner">Public Vars</span></a></h3><ul><li class="depth-1"><a href="overseer.api.html#var--.3Egraph-txn"><div class="inner"><span>-&gt;graph-txn</span></div></a></li><li class="depth-1"><a href="overseer.api.html#var-abort"><div class="inner"><span>abort</span></div></a></li><li class="depth-1"><a href="overseer.api.html#var-abort-silent"><div class="inner"><span>abort-silent</span></div></a></li><li class="depth-1"><a href="overseer.api.html#var-default-config"><div class="inner"><span>default-config</span></div></a></li><li class="depth-1"><a href="overseer.api.html#var-harness"><div class="inner"><span>harness</span></div></a></li><li class="depth-1"><a href="overseer.api.html#var-job-assertion"><div class="inner"><span>job-assertion</span></div></a></li><li class="depth-1"><a href="overseer.api.html#var-start"><div class="inner"><span>start</span></div></a></li><li class="depth-1"><a href="overseer.api.html#var-validate-graph-handlers"><div class="inner"><span>validate-graph-handlers</span></div></a></li></ul></div><div class="namespace-docs" id="content"><h2 class="anchor" id="top">overseer.api</h2><div class="doc"><pre class="plaintext">User-facing core API
</pre></div><div class="public anchor" id="var--.3Egraph-txn"><h3>-&gt;graph-txn</h3><div class="usage"><code>(-&gt;graph-txn graph)</code><code>(-&gt;graph-txn graph tx)</code></div><div class="doc"><pre class="plaintext">Entry point to assert a sequence of jobs into the system.
Given a job graph, and optional additional argument data,
return a sequence of Datomic transactions that can be
asserted directly

Ex:
  (def txns (-&gt;graph-txn
              {:start []
               :process-1a [:start]
               :process-1b [:process-1a]
               :process-2 [:start]
               :finish [:process-1b :process-2]}
              {:organization-id 123}))
  @(d/transact conn txns)</pre></div></div><div class="public anchor" id="var-abort"><h3>abort</h3><div class="usage"><code>(abort msg)</code></div><div class="doc"><pre class="plaintext">Control-flow helper to immediately mark a job as aborted from within a handler
and abort all of its dependents (halts handler execution)
Fails loudly by default - will log an error and and send to Sentry.
See also `abort-silent`</pre></div></div><div class="public anchor" id="var-abort-silent"><h3>abort-silent</h3><div class="usage"><code>(abort-silent msg)</code></div><div class="doc"><pre class="plaintext">Like `abort`, but does not send exceptions to Sentry
</pre></div></div><div class="public anchor" id="var-default-config"><h3>default-config</h3><div class="usage"></div><div class="doc"><pre class="plaintext">Map of default configuration (connects to local Datomic)
</pre></div></div><div class="public anchor" id="var-harness"><h3>harness</h3><div class="usage"><code>(harness handler wrapper)</code><code>(harness handler k wrapper)</code></div><div class="doc"><pre class="plaintext">A mechanism to &apos;wrap&apos; job handlers, giving one the ability
to provide additional context, inject dependencies, or otherwise
alter the flow of execution. Conceptually, harnessing is similar to
the idea behind Ring middleware.

Accepts a standard job handler (map or function) and a
`wrapper` function which will be called with the *function* specified
in your handler and is expected to return a new *function* with the
same signature. If your handler is a map, it will be transparently
constructed/deconstructed; harnesses work solely in terms of functions.

For example, a harness that simply implements the default behavior for
a processor is:

  (defn my-harness [f]
    (fn [job]
      (f job)))

A more substantive harness can be used to provide jobs with additional
context or inject dependencies such as a database connection:

  (defn my-harness [f]
    (fn [job]
      (let [modified-job (assoc job :conn (d/connect my-datomic-uri))]
        (f modified-job))))

Or add logging:

  (defn logging-harness [f]
    (fn [job]
      (println &quot;START execution of &quot; (:job/id job))
      (f job)
      (println &quot;FINISH execution of &quot; (:job/id job))))

After defining a harness, in the job-handlers map one specifies

  {:my-job (overseer.api/harness my-job/run my-harness)}

Following the previous example, within your handler you now have
additional context available:

  (defn run [{:keys [conn] :as job}] ...)

If your handler is a map, you can optionally specify a key to harness a
specific stage; the default is :process. For example, to harness
a post-processor:

  {:my-job (overseer.api/harness my-job/run :post-process my-harness)}

If you attempt to harness a missing stage for a given job, the wrapper will
be invoked with a properly-formed identity function, meaning you can write
your harnesses in a single consistent fashion, and, for example, universally
harness a post-processor for a set of handlers that may or may not define
their own post-processor.</pre></div></div><div class="public anchor" id="var-job-assertion"><h3>job-assertion</h3><div class="usage"></div><div class="doc"><pre class="plaintext">Construct a single job assertion, given a type and optional
user-provided txn data
(job-assertion job-type)
(job-assertion job-type arg-map)

Ex:
  (def tx1 (job-assertion :my-job-type-1))
  (def tx2 (job-assertion :my-job-type-2 {:job/organization-id 123}))
  @(d/transact conn [tx1 tx2])</pre></div></div><div class="public anchor" id="var-start"><h3>start</h3><div class="usage"></div><div class="doc"><pre class="plaintext">Start the system as a library
(start config handler-map)</pre></div></div><div class="public anchor" id="var-validate-graph-handlers"><h3>validate-graph-handlers</h3><div class="usage"><code>(validate-graph-handlers handlers graph)</code></div><div class="doc"><pre class="plaintext">Assert that a given graph only references handlers defined
in the `handlers` map</pre></div></div></div></body></html>